#:schema https://raw.githubusercontent.com/YunoHost/apps/master/schemas/manifest.v2.schema.json

packaging_format = 2

id = "pleroma"
name = "Pleroma"
description.en = "Federated social networking server built on open protocols"
description.fr = "Serveur de réseautage social fédéré basé sur des protocoles ouverts"

version = "2.7.0~ynh1"

maintainers = []

[upstream]
license = "AGPL-3.0-only"
website = "https://pleroma.social/"
admindoc = "https://docs.pleroma.social/"
code = "https://git.pleroma.social/pleroma/pleroma/"
cpe = "cpe:2.3:a:kpherox:pleroma"
fund = "https://liberapay.com/Pleroma-euro/"

[integration]
yunohost = ">=11.2"
architectures = ["amd64", "armhf", "arm64"]
multi_instance = false
ldap = true
sso = false
disk = "200M"
ram.build = "50M"
ram.runtime = "50M"

[install]
    [install.domain]
    type = "domain"

    [install.init_main_permission]
    type = "group"
    default = "visitors"

    [install.admin]
    type = "user"

    [install.password]
    type = "password"

    [install.name]
    ask.en = "Choose a name for your Pleroma instance"
    ask.fr = "Choisissez un nom pour votre instance Pleroma"
    type = "string"
    example = "My_Pleroma"
    default = "My_Pleroma"

    [install.registration]
    ask.en = "Should registration be open to users who do not have a YunoHost account on the system?"
    ask.fr = "L'inscription doit-elle être ouverte aux utilisateurs qui n'ont pas de compte YunoHost sur le système ?"
    type = "boolean"
    default = false

    [install.cache]
    ask.en = "Enable media-cache for your instance"
    ask.fr = "Activer le cache média pour votre instance"
    type = "boolean"
    default = true

    [install.size]
    ask.en = "Select the cache size. If you did not enabled media-cache in above option then this option will have no effect"
    ask.fr = "Sélectionner la taille du cache. Si vous n'avez pas activé le cache média ci-dessus, cette option n'aura aucun effet"
    type = "select"
    choices = ["2g", "5g", "10g", "20g", "40g", "80g"]
    default = "5g"

[resources]
    [resources.sources.main]
    amd64.url = "https://git.pleroma.social/api/v4/projects/2/jobs/artifacts/stable/download?job=amd64"
    amd64.sha256 = "451435dc2cc48b21a62cce1c0532f4746ee7b07e0bb2b40dca9210cea3fa0c17"

    armhf.url = "https://git.pleroma.social/api/v4/projects/2/jobs/artifacts/stable/download?job=arm"
    armhf.sha256 = "22da30dec93437e3ecb33270a9377bd8d8965554c2761af81e2268e11633ea56"

    arm64.url = "https://git.pleroma.social/api/v4/projects/2/jobs/artifacts/stable/download?job=arm64"
    arm64.sha256 = "8cf12cee96adf9e64a60443109ed113a95ab7d3406eec5b18661a0d8d63abffb"
    
    format = "zip"
    extract = true

    # Those assets are to make autoupdate work, but are dummy artifacts, because
    # We need to find the actual artifacts from the CI jobs...
    autoupdate.strategy = "latest_gitlab_release"
    autoupdate.asset.amd64 = "source.tar.gz"
    autoupdate.asset.arm64 = "source.tar.gz"
    autoupdate.asset.armhf = "source.tar.gz"

    [resources.system_user]

    [resources.install_dir]

    [resources.data_dir]
    subdirs = [
        "uploads", "static", "static/emoji",
    ]

    [resources.permissions]
    main.url = "/"

    [resources.ports]
    main.default = 8095

    [resources.apt]
    packages = [
        "curl",
        "unzip",
        "libncurses5",
        "imagemagick",
        "ffmpeg",
        "exiftool",
        "libimage-exiftool-perl",
        "postgresql",
        "postgresql-contrib",
    ]

    [resources.database]
    type = "postgresql"
